---
title: "ESM 204 HW4"
author: "Tommy King"
date: "5/23/2022"
output: html_document
---

```{r setup, include=FALSE, message = FALSE, warning= FALSE}
knitr::opts_chunk$set(echo = FALSE, message= FALSE, warning = FALSE)

# loading packages 
library(tidyverse)
library(here)
library(dplyr)
library(janitor)

# The first, “damages.csv” provides new model estimates of the annual total damages from climate change at different levels of warming (in degrees C). The second dataset, “warming.csv” contains estimates of a baseline future climate trajectory (in degrees C) until 2100, and a second trajectory that adds a one-time pulse of CO2 today to the atmosphere. The pulse is 35 billion tons of carbon, which is roughly equal to annual global emissions. You can think of this as a “small” one-time pulse in carbon emissions.

# reading in the data and mutating it to show values in billions of dollars

damages_subset <- read_csv(here("damages.csv")) %>% 
  clean_names() %>% 
  mutate(damages = damages/1000000000)

warming_subset <- read_csv(here("warming (1).csv")) %>% 
  clean_names()

```

### Question 1: Damage Equation
```{r}
#Using damages.csv, estimate a quadratic damage function relating the dollar value of damages to the change in global mean temperature. Estimate a model with a zero intercept because damages by construction must equal zero when there is no climate change. Plot your estimated damage function, overlaid with a scatterplot of the underlying data.

#


#Squaring the warming variables. 
warming_new <- damages_subset$warming^2

# defining the damages quadratic function
damages_function <- lm(damages ~ 0 + warming + warming_new, data = damages_subset)

warming <- damages_subset$warming
damages_2 <- predict(damages_function)

damage_function <- function(x){
  damages_function$coefficients[1]*x+damages_function$coefficients[2]*x^2
}

```

#### **Figure 1: Damages Resulting from Climate Change**
```{r}
#graphing the function
ggplot(data = damages_subset, aes(x = warming, y = damages)) + 
  geom_point(color = "blue") + 
  geom_smooth(aes(x = warming, y = damages_2, color = "red")) + 
  labs(x = "Warming (Degrees Celsius)", y = 
         "Damages ($ billions)")
```

### Question 2: 
```{r}
# Use warming.csv and your estimated damage function to predict damages in each year under the baseline climate and the pulse scenario. Make four plots: (1) damages over time without the pulse, (2) damages over time with the pulse, (3) the difference in damages over time that arises from the pulse, and (4) the difference in damages over time from the pulse per ton of CO2 (you can assume that each ton of the pulse causes the same amount of damage).

# define the pulse 
pulse_tons <- 35 

# creating new variables for damages that reflect the warming variables from the warming subset

damages <- warming_subset %>% 
  mutate(damages_baseline = damage_function(warming_baseline)) %>% 
  mutate(damages_pulse = damage_function(warming_pulse)) %>% 
  mutate(damages_difference = damages_pulse - damages_baseline) %>% 
  mutate(damages_difference_tons = damages_difference/pulse_tons)

# creating graph number 1 for both scenarios and total damages

ggplot(data = damages, aes(x=year)) + 
  geom_smooth(aes(y= damages_baseline), color = "blue")+ 
  geom_smooth(aes(y=damages_pulse), color = "orange") + 
  labs(x = "Year", y = "Damages ($ billions)")

```


*Visualization Analysis: Difference between pulse and no pulse scenario appears to be trivial.* 

#### Figure 3: Absolute vs. Per Ton Damages Oer Time 
```{r}
# creating graph showing the diffrences between absolute and per ton damages over time between the two scenarios. Facet wrapping two plots to show these differences.

baseline_graph <- ggplot(data= damages, 
                        aes(x = year, y = damages_difference)) + 
  geom_smooth(color = "red") + 
  labs(x = "Year", y = "Difference in Damages ($ billions)")

baseline_graph

# Creating second plot in tons 

tons_graph <- ggplot(data = damages, 
                     aes(x = year, y = damages_difference_tons)) + 
  geom_smooth(color = "purple") + 
  labs(x= "Year", y = "Difference in Damages ($ billions per ton")

tons_graph

```
**Figure 3 Analysis: Difference in damages rate over time moderately decreases, however, the overall damages increases exponentially from current day to 2100.**


